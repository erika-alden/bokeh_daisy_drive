<!DOCTYPE html>
<meta charset="utf-8">

<head>
  <link rel="stylesheet" type="text/css" href="graph.css">
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://dimplejs.org/dist/dimple.v2.1.6.min.js"></script>
</head>

<body>


  <label for="station_select"
          style="display: inline-block; width: 140px; text-align: right">
    Station =
  </label>
  <select id="station_select" onchange="update_url()">
    <option value="plza">El Cerrito Plaza</option>
    <option value="mont">Montgomery</option>
  </select>
  <label for="day_select"
          style="display: inline-block; width: 140px; text-align: right">
    Weekday =
  </label>
  <select id="day_select" onchange="update_url()">
    <option value="0">Weekday</option>
    <option value="1">Saturday</option>
    <option value="2">Sunday</option>
  </select>
  <label for="dest"
         style="display: inline-block; width: 140px; text-align: right">
         Destination =
  </label>
  <select id="dest" onchange="update_url()">
    <option value="Fremont">Fremont</option>
    <option value="Richmond">Richmond</option>
    <option value="Millbrae">Millbrae</option>
    <option value="Pittsburg/Bay Point">Pittsburg/Bay Point</option>
    <option value="Dublin/Pleasanton">Dublin/Pleasanton</option>
    <option value="SF Airport">SF Airport</option>
    <option value="SFO/Millbrae">SFO/Millbrae</option>
  </select>
</p>
<p>
  <label for="time"
         style="display: inline-block; align: left; width: 140px; text-align: right">
         Time = <span id="prettyTime">...</span>
       </label>
  <input type="range" id="time" min="240" max="1440" style="width:600px" value="460">
</p>
<p>
    Click slider and use arrow keys to adjust time.
</p>



<script datasci_update_url>
// The base endpoint to receive data from. See update_url()                     
var URL_BASE = "http://daisydrives.media.mit.edu/";

// Update graph in response to inputs                                           
d3.select("#dest").on("input", make_graph);
d3.select("#day_select").on("input", make_graph);
d3.select("#station_select").on("input", make_graph);
d3.select("#time").on("input", make_graph);

// Update the time displayed (XX:XX) next to the time slider                    
function update_slider(time) {
  var dateObj = new Date();
  dateObj.setHours(Math.floor(time/60));
  dateObj.setMinutes(time % 60);
  d3.select("#prettyTime")
    .text(dateObj.toTimeString().substring(0, 5));
}
// Return url to recieve csv data with query filled in from input fields        
function update_url() {
  return URL_BASE +
        "?dest=" + document.getElementById("dest").value +
        "&time=" + document.getElementById("time").value +
        "&station=" + document.getElementById("station_select").value +
        "&day=" + document.getElementById("day_select").value;
}

// Convert csv data to number types
function type(d) {
  d3.select("body").append("p").text("type function executing");
  d3.select("body").append("p").text(d);
  d.etd = +d.etd;
  d.count = +d.count;
  d3.select("body").append("p").text(d.etd);
  d3.select("body").append("p").text(d.count);
  return d;
}

var svg = dimple.newSvg("body", 800, 600);
var data = [
      { "Word":"Hello", "Awesomeness":2000 },
      { "Word":"World", "Awesomeness":3000 }
    ];

function make_graph() {
  update_slider(+document.getElementById("time").value);
  url = update_url();
  d3.select("body").append("p").text(url);
  d3.csv(url, function(data){
    d3.select("body").append("p").text("hi im inside csv");
     d3.select("body").append("p").text(data);
  });
//  data = type(url);
//  d3.select("body").append("p").text(data.count);
//  d3.select("body").append("p").text(data.etd);
//  d3.csv(url, type, function(error, data) {
//    d3.select("body").append("p").text(data);
//      d3.select("body").append("p").text(function(d) { return d.count; });
//  });
  svg.selectAll("*").remove();
  var chart = new dimple.chart(svg, data);
  chart.addCategoryAxis("x", "Word");
  chart.addMeasureAxis("y", "Awesomeness");
  chart.addSeries(null, dimple.plot.line);

  chart.draw();
  svg.append("text").attr("x", (svg[0][0].clientWidth / 2)).attr("y", 14).attr("text-anchor", "middle").style("font-size", "13px").style("font-weight", "bold").text(url);  
}

make_graph();
</script>

</body>
